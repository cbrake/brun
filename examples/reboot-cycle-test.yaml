# BRun Configuration File
# See https://github.com/cbrake/brun for documentation
# This script can be used to run reboot cycles to test
# the stability on a Linux system (common with products
# running Embedded Linux).

config:
  state_location: /root/brun-state.yaml

units:
  # the boot trigger is not working reliably on an AGX Orin board, so
  # leave it for debugging, but the main logic is currently
  # run with a start trigger.
  - boot:
      name: boot-trigger
      always:
        - counter
  - start:
      name: start-trigger
      always:
        - counter
        - check-nvme
  - run:
      name: check-nvme
      script: |
        if [ ! -e "/dev/nvme0" ]; then
          echo "NVME drive not detected"
          exit -1
        fi
      on_failure:
        - log-error
        - error-counter
      on_success:
        - counter
      always:
        - reboot
  - log:
      name: log-error
      file: /var/lib/brun/error.log
  - count:
      name: error-counter
  - count:
      name: counter
  - reboot:
      name: reboot
      # give us time to log in and stop the reboot
      delay: 20

